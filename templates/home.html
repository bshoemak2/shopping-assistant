{% extends "base.html" %}
{% block content %}
    <div class="image-container">
        <img src="{{ url_for('static', filename='funny_image_2.jpg') }}" alt="Cyberpunk Shopper Chaos" class="funny-image">
        <img src="{{ url_for('static', filename='funny_image_4.jpg') }}" alt="Neon Bargain Hunt" class="funny-image">
    </div>
    <p class="disclosure">As an Amazon Associate, I earn from qualifying purchases.</p>
    <video class="promo-video" controls>
        <source src="{{ url_for('static', filename='fart_chicken/EmojiMovie764632741.MOV') }}" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <div class="mystery-product-section">
        <button class="mystery-button" onclick="revealMysteryProduct()">Daily Mystery Prank Reveal!</button>
        <div class="mystery-product" id="mysteryProduct">
            {% if mystery_product %}
                Mystery Prank: <a href="{{ mystery_product.url }}" target="_blank" onclick="trackAffiliateClick('{{ mystery_product.name }} (Mystery)')">{{ mystery_product.name }}</a>
            {% endif %}
        </div>
    </div>

    {% if seasonal_highlights %}
    <div class="product-section" id="seasonal-highlights">
        <h2 class="section-title">üåü Seasonal Prank Highlights</h2>
        <p class="section-subtitle">Perfect picks to prank this season!</p>
        {% with products=seasonal_highlights %}
            {% include 'product_list.html' %}
        {% endwith %}
    </div>
    {% endif %}

    <div class="product-section popular-picks" id="popular-picks">
        <h2 class="section-title">‚≠ê Top Prank Picks</h2>
        <p class="section-subtitle">Our best-selling gags for pranksters!</p>
        <ul class="product-list">
            {% for product in popular_picks %}
            <li class="product-item">
                <img src="{{ product.image }}" alt="{{ product.name }}" class="product-image">
                <a href="{{ product.url }}" target="_blank" onclick="trackAffiliateClick('{{ product.name }}')" class="product-link">{{ product.name }}</a>
                <span class="product-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4/5)</span>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="product-section" id="wearable-pranks">
        <h2 class="section-title">Wearable Pranks</h2>
        <p class="section-subtitle">Gag gifts you can wear to cause a scene!</p>
        {% with products=wearable_pranks %}
            {% include 'product_list.html' %}
        {% endwith %}
    </div>

    <div class="product-section" id="desk-disasters">
        <h2 class="section-title">Desk Disasters</h2>
        <p class="section-subtitle">Pranks to chaos-ify your workspace!</p>
        {% with products=desk_disasters %}
            {% include 'product_list.html' %}
        {% endwith %}
    </div>

    <div class="product-section" id="home-hilarity">
        <h2 class="section-title">Home Hilarity</h2>
        <p class="section-subtitle">Gag gifts to turn your home into a prank zone!</p>
        {% with products=home_hilarity %}
            {% include 'product_list.html' %}
        {% endwith %}
    </div>

    <p class="hacks-prompt" id="all-products">Browse All Gag Gifts Now! <span class="cta-urgent">Limited Stock!</span></p>
    {% with products=all_products %}
        {% include 'product_list.html' %}
    {% endwith %}

    <div class="product-section">
        <h2 class="section-title">üéâ Best Gag Gifts for Weddings</h2>
        <p class="section-subtitle">Add some humor to the big day with these hilarious picks!</p>
        <ul class="product-list">
            <li class="product-item">
                <img src="https://m.media-amazon.com/images/I/41XbQ9k0Q-L._AC_.jpg" alt="Fart Whistles" class="product-image">
                <a href="https://amzn.to/4kQ39A7" target="_blank" onclick="trackAffiliateClick('Fart Whistles (Wedding)')" class="product-link">Fart Whistles - Loads of Fun for the Reception</a>
                <span class="product-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4/5)</span>
                <span class="cta-urgent">Prank Your Momma Today!</span>
            </li>
            <li class="product-item">
                <img src="https://m.media-amazon.com/images/I/51Z0k9k0Q-L._AC_.jpg" alt="Poo Espresso Cups" class="product-image">
                <a href="https://amzn.to/4kVaBtW" target="_blank" onclick="trackAffiliateClick('Expresso Cups in Poo Colors (Wedding)')" class="product-link">Expresso Cups in Poo Colors - A Crappy Gift for a Laugh</a>
                <span class="product-rating">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3/5)</span>
                <span class="cta-urgent">Limited Stock!</span>
            </li>
            <li class="product-item">
                <img src="https://m.media-amazon.com/images/I/61eiIozbjeL._AC_SY625_.jpg" alt="Rubber Chicken Purse" class="product-image">
                <a href="https://amzn.to/4hAMdL5" target="_blank" onclick="trackAffiliateClick('Rubber Chicken Purse (Wedding)')" class="product-link">Rubber Chicken Purse - Cluck in Style at the After-Party</a>
                <span class="product-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5/5)</span>
                <span class="cta-urgent">Prank Your Boss Now!</span>
            </li>
        </ul>
    </div>

    <div class="product-section">
        <h2 class="section-title">ü§° Funny Office Prank Ideas for April Fools</h2>
        <p class="section-subtitle">Make your coworkers laugh with these prank-ready products!</p>
        <ul class="product-list">
            <li class="product-item">
                <img src="https://m.media-amazon.com/images/I/41XyZ0k9k0Q-L._AC_.jpg" alt="Fake Poop" class="product-image">
                <a href="https://amzn.to/4hEoA4v" target="_blank" onclick="trackAffiliateClick('Fake Poop (Office)')" class="product-link">Fake Poop - Leave It on a Desk for a Scream</a>
                <span class="product-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4/5)</span>
                <span class="cta-urgent">Limited Stock!</span>
            </li>
            <li class="product-item">
                <img src="https://m.media-amazon.com/images/I/51XyZ0k9k0Q-L._AC_.jpg" alt="Silly String Shooter" class="product-image">
                <a href="https://amzn.to/4l41QNZ" target="_blank" onclick="trackAffiliateClick('Silly String Shooter (Office)')" class="product-link">Silly String Shooter - Spray Chaos in the Break Room</a>
                <span class="product-rating">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3/5)</span>
                <span class="cta-urgent">Prank Your Momma Today!</span>
            </li>
            <li class="product-item">
                <img src="https://m.media-amazon.com/images/I/61XyZ0k9k0Q-L._AC_.jpg" alt="Giant Googly Eyes" class="product-image">
                <a href="https://amzn.to/4i5b2PL" target="_blank" onclick="trackAffiliateClick('Giant Googly Eyes (Office)')" class="product-link">Giant Googly Eyes - Stick Them on Office Supplies</a>
                <span class="product-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5/5)</span>
                <span class="cta-urgent">Prank Your Boss Now!</span>
            </li>
        </ul>
    </div>

    <div class="reviews-section">
        <h2 class="section-title">Prankster Reviews</h2>
        <p class="section-subtitle">See what our pranksters are saying!</p>
        <div class="reviews-list">
            {% for review in reviews %}
                <p class="review-item">"{{ review.text }}" - {{ review.author }} <span class="review-date">April 1, 2025</span></p>
            {% endfor %}
            <p class="review-item">"The Fake Poop had my boss screaming‚Äî10/10!" - PrankMaster99 <span class="review-date">April 1, 2025</span></p>
            <p class="review-item">"Fart Whistles at the wedding were a hit!" - GiggleGuru <span class="review-date">March 30, 2025</span></p>
        </div>
        <form id="review-form" onsubmit="submitReview(event)">
            <textarea name="review" placeholder="Tell us how your prank went!" required></textarea>
            <button type="submit" class="btn">Submit Your Prank Story</button>
        </form>
    </div>

    <div class="email-signup">
        <h2 class="section-title">JOIN THE PRANK PARTY! üéâ</h2>
        <p class="section-subtitle">Get 'The Ultimate Prank Cheat Sheet' for FREE and never miss a laugh!</p>
        <form action="{{ url_for('subscribe') }}" method="POST">
            <input type="email" name="email" placeholder="Enter your email" required>
            <button type="submit" class="btn">Sign Me Up for the Shenanigans! <span class="cta-urgent">Limited Offer!</span></button>
        </form>
        <p style="font-size: 0.75rem; margin-top: 10px;">
            By signing up, you agree to our <a href="/privacy">Privacy Policy</a> and to receive monthly prank ideas and Amazon product recommendations.
        </p>
    </div>
    <p>Contact us for issues and suggestions: <a href="mailto:bshoemak@mac.com">bshoemak@mac.com</a></p>
{% endblock %}

{% block scripts %}
    <script>
        function trackAffiliateClick(productName) {
            if (typeof twq !== 'undefined') {
                const eventData = {
                    value: 1.00,
                    currency: 'USD',
                    contents: productName,
                    conversion_id: 'affiliate-click-' + Date.now()
                };
                console.log('Tracking affiliate click:', JSON.stringify(eventData));
                twq('track', 'Custom', eventData);
            } else {
                console.error('Twitter pixel not loaded');
            }
        }

        function revealMysteryProduct() {
            document.getElementById('mysteryProduct').style.display = 'block';
        }

        function submitReview(event) {
            event.preventDefault();
            const reviewText = document.querySelector('#review-form textarea').value;
            fetch('/submit_review', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: reviewText, author: 'Anonymous Prankster' })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Review submitted successfully!') {
                    const reviewsList = document.getElementById('reviews-list');
                    reviewsList.innerHTML += `<p class="review-item">"${reviewText}" - Anonymous Prankster <span class="review-date">${new Date().toLocaleDateString()}</span></p>`;
                    document.querySelector('#review-form').reset();
                } else {
                    alert('Failed to submit review: ' + data.message);
                }
            })
            .catch(error => console.error('Error submitting review:', error));
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.fun-stuff-score').forEach(element => {
                const productId = element.getAttribute('data-id');
                const savedScore = localStorage.getItem(`fun-stuff-score-${productId}`);
                if (savedScore !== null) {
                    element.querySelector('.score-value').textContent = savedScore;
                }
            });
        });
    </script>
{% endblock %}