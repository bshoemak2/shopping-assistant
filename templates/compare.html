<!DOCTYPE html>
<html>
<head>
    <title>Shopping Assistant</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input { padding: 5px; width: 300px; }
        button { padding: 5px 10px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Compare Products</h1>
    <input type="text" id="products" placeholder="e.g., wireless earbuds, bluetooth speaker">
    <button onclick="compare()">Compare</button>
    <div id="result"></div>

    <script>
        async function compare() {
            const input = document.getElementById('products').value;
            const products = input.split(',').map(p => p.trim());
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Loading...';

            try {
                console.log('Sending request with products:', products);  // Debug
                const response = await fetch('/compare', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({products})
                });
                console.log('Response status:', response.status);  // Debug
                const data = await response.json();
                console.log('Response data:', data);  // Debug
                resultDiv.innerHTML = '';

                if (!response.ok || data.error || !data.comparisons) {
                    resultDiv.innerHTML = `<p class="error">${data.error || 'No results found'}</p>`;
                    return;
                }

                const table = document.createElement('table');
                table.innerHTML = `
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Rating</th>
                        <th>Positive Reviews</th>
                        <th>Negative Reviews</th>
                        <th>Key Feedback</th>
                    </tr>
                `;
                for (const [name, details] of Object.entries(data.comparisons)) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${name}</td>
                        <td>$${details.price.toFixed(2)}</td>
                        <td>${details.rating}/5</td>
                        <td>${details.review_summary.positive}</td>
                        <td>${details.review_summary.negative}</td>
                        <td>${Object.entries(details.review_summary.keywords)
                            .map(([word, count]) => `${word} (${count})`)
                            .join(', ')}</td>
                    `;
                    table.appendChild(row);
                }
                resultDiv.appendChild(table);
            } catch (error) {
                console.error('Fetch error:', error);  // Debug
                resultDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>